# used for debugging download options

import fs from 'fs-extra';
import path from 'path-extra';
import ospath from 'ospath';
// helpers
import * as resourcesDownloadHelpers from '../src/helpers/resourcesDownloadHelpers';
import * as parseHelpers from '../src/helpers/parseHelpers';
// constants
import * as errors from '../src/resources/errors';

jest.unmock('fs-extra');
jest.unmock('../src/helpers/downloadHelpers');
jest.unmock('../src/helpers/zipFileHelpers');
jest.unmock('../src/helpers/unzipFileHelpers');

jasmine.DEFAULT_TIMEOUT_INTERVAL = 10000;
const catalog = require('./fixtures/api.door43.org/v3/subjects/pivoted.json');

describe('Tests for resourcesDownloadHelpers.downloadAndProcessResource()', () => {
  const resourcesPath = path.join(ospath.home(), 'translationCore/resources');

  it('Test resourcesDownloadHelpers.downloadAndProcessResource() for ru rlob', () => {
    const resourcesPath = path.join(ospath.home(), 'resources');
    const resource = {
      languageId: 'ru',
      resourceId: 'rlob',
      remoteModifiedTime: '0001-01-01T00:00:00+00:00',
      downloadUrl: 'https://git.door43.org/ru_gl/ru_rlob/archive/master.zip',
      version: '1',
      subject: 'Bible',
      catalogEntry: {
        subject: {},
        resource: {},
        format: {},
      },
      ignoreMissingProjects: true,
    };
    const downloadErrors = [];
    const removeOldVersions = false;
    return resourcesDownloadHelpers.downloadAndProcessResource(resource, resourcesPath, downloadErrors, removeOldVersions).then((res) => {
      expect(res).toEqual(resource);
    });
  });

  it('Test resourcesDownloadHelpers.downloadAndProcessResource() for en ult', () => {
    const resourcesPath = path.join(ospath.home(), 'resources');
    const resource = {
      languageId: 'en',
      resourceId: 'ult',
      remoteModifiedTime: '0001-01-01T00:00:00+00:00',
      downloadUrl: 'https://cdn.door43.org/en/ult/v18/ult.zip',
      version: '18',
      subject: 'Bible',
      catalogEntry: {
        subject: {},
        resource: {},
        format: {},
      },
    };
    const downloadErrors = [];
    const removeOldVersions = false;
    return resourcesDownloadHelpers.downloadAndProcessResource(resource, resourcesPath, downloadErrors, removeOldVersions).then((res) => {
      expect(res).toEqual(resource);
    });
  });

  it('Test resourcesDownloadHelpers.downloadAndProcessResource() for el-x-koine ugnt', () => {
    const resourcesPath = path.join(ospath.home(), 'resources');
    const resource = {
      languageId: 'el-x-koine',
      resourceId: 'ugnt',
      remoteModifiedTime: '0001-01-01T00:00:00+00:00',
      downloadUrl: 'https://cdn.door43.org/el-x-koine/ugnt/v0.16/ugnt.zip',
      version: '0.16',
      subject: 'Bible',
      catalogEntry: {
        subject: {},
        resource: {},
        format: {},
      },
    };
    const downloadErrors = [];
    const removeOldVersions = false;
    return resourcesDownloadHelpers.downloadAndProcessResource(resource, resourcesPath, downloadErrors, removeOldVersions).then((res) => {
      expect(res).toEqual(resource);
    });
  });

});

'el-x-koine ugnt 0.16 ugnt'
